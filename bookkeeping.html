<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€²éšè¨˜å¸³è»Ÿé«”</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 900px; margin: 20px auto; padding: 20px; }
        .nav { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .nav button { background: #4CAF50; color: white; border: none; padding: 12px 24px; margin: 0 5px; border-radius: 25px; cursor: pointer; font-size: 16px; transition: all 0.3s; }
        .nav button.active { background: #2196F3; }
        .nav button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .page { display: none; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .page.active { display: block; }
        form input, form select, form button { padding: 12px; margin: 8px 4px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; }
        form button[type="submit"] { background: linear-gradient(45deg, #4CAF50, #45a049); color: white; border: none; min-width: 120px; }
        .records-grid { display: grid; gap: 15px; margin-top: 20px; }
        .record-card { background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 5px solid #4CAF50; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .record-card.expense { border-left-color: #f44336; }
        .amount { font-size: 1.4em; font-weight: bold; }
        .income .amount { color: #4CAF50; }
        .expense .amount { color: #f44336; }
        .delete-btn { background: #f44336; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; text-align: center; }
        .backup-section { text-align: center; margin: 30px 0; }
        .backup-btn { background: #FF9800; color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 18px; cursor: pointer; margin: 10px; }
        #fileInput { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: white; margin-bottom: 10px;">ğŸ’° é€²éšè¨˜å¸³ç³»çµ±</h1>
        
        <div class="nav">
            <button onclick="showPage('record')" class="active">ğŸ“ è¨˜éŒ„</button>
            <button onclick="showPage('stats')">ğŸ“Š çµ±è¨ˆ</button>
            <button onclick="showPage('backup')">ğŸ’¾ å‚™ä»½</button>
        </div>

        <!-- è¨˜éŒ„é é¢ -->
        <div id="record" class="page active">
            <form id="recordForm">
                <input type="date" id="date" required>
                <input type="number" id="amount" placeholder="é‡‘é¡" step="0.01" min="0" required>
                <input type="text" id="category" placeholder="é¡åˆ¥ï¼ˆå¦‚ï¼šé£Ÿç‰©ã€äº¤é€šï¼‰" required>
                <select id="type">
                    <option value="income">ğŸ’µ æ”¶å…¥</option>
                    <option value="expense">ğŸ’¸ æ”¯å‡º</option>
                </select>
                <button type="submit">æ–°å¢è¨˜éŒ„</button>
            </form>
            <div id="records" class="records-grid"></div>
        </div>

        <!-- çµ±è¨ˆé é¢ -->
        <div id="stats" class="page">
            <div class="stats">
                <div class="stat-card">
                    <h3>ç¸½æ”¶å…¥</h3>
                    <div id="totalIncome">$0</div>
                </div>
                <div class="stat-card">
                    <h3>ç¸½æ”¯å‡º</h3>
                    <div id="totalExpense">$0</div>
                </div>
                <div class="stat-card">
                    <h3>é¤˜é¡</h3>
                    <div id="balance">$0</div>
                </div>
                <div class="stat-card">
                    <h3>è¨˜éŒ„æ•¸</h3>
                    <div id="recordCount">0</div>
                </div>
            </div>
        </div>

        <!-- å‚™ä»½é é¢ -->
        <div id="backup" class="page">
            <div class="backup-section">
                <h2>è³‡æ–™å‚™ä»½èˆ‡é‚„åŸ</h2>
                <p>é»æ“Šä¸‹è¼‰å°‡æ‰€æœ‰è¨˜éŒ„åŒ¯å‡ºç‚ºCSVæª”æ¡ˆï¼Œå¯å­˜åˆ°é›»è…¦å‚™ä»½</p>
                <button class="backup-btn" onclick="exportData()">ğŸ“¥ ä¸‹è¼‰CSVå‚™ä»½</button>
                <label for="fileInput" class="backup-btn">ğŸ“¤ å¾æª”æ¡ˆåŒ¯å…¥</label>
                <input type="file" id="fileInput" accept=".csv" onchange="importData(event)">
                <p style="margin-top: 20px; font-size: 14px; color: #666;">
                    * å»ºè­°æ¯æœˆå‚™ä»½ä¸€æ¬¡ï¼Œé¿å…localStorageæ»¿è¼‰æˆ–ç€è¦½å™¨æ¸…é™¤å¿«å–
                </p>
            </div>
        </div>
    </div>

    <script>
        let records = JSON.parse(localStorage.getItem('records')) || [];
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            if (pageId === 'stats') updateStats();
        }
        
        function renderRecords() {
            const container = document.getElementById('records');
            container.innerHTML = '';
            
            records.forEach((record, index) => {
                const card = document.createElement('div');
                card.className = `record-card ${record.type}`;
                card.innerHTML = `
                    <div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 5px;">${record.date}</div>
                        <div style="font-weight: bold;">${record.category}</div>
                        <div class="amount">${parseFloat(record.amount).toLocaleString()}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteRecord(${index})">åˆªé™¤</button>
                `;
                container.appendChild(card);
            });
        }
        
        function updateStats() {
            let income = 0, expense = 0;
            records.forEach(r => {
                const amt = parseFloat(r.amount);
                if (r.type === 'income') income += amt;
                else expense += amt;
            });
            
            document.getElementById('totalIncome').textContent = `$${income.toLocaleString()}`;
            document.getElementById('totalExpense').textContent = `$${expense.toLocaleString()}`;
            document.getElementById('balance').textContent = `$${(income - expense).toLocaleString()}`;
            document.getElementById('recordCount').textContent = records.length;
        }
        
        document.getElementById('recordForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const record = {
                date: document.getElementById('date').value,
                amount: document.getElementById('amount').value,
                category: document.getElementById('category').value,
                type: document.getElementById('type').value
            };
            records.unshift(record);
            localStorage.setItem('records', JSON.parse(JSON.stringify(records))); // é˜²æ·±åº¦è¤‡è£½å•é¡Œ
            renderRecords();
            e.target.reset();
            document.getElementById('date').valueAsDate = new Date();
        });
        
        function deleteRecord(index) {
            if (confirm('ç¢ºå®šåˆªé™¤æ­¤ç­†è¨˜éŒ„ï¼Ÿ')) {
                records.splice(index, 1);
                localStorage.setItem('records', JSON.stringify(records));
                renderRecords();
            }
        }
        
        // CSVåŒ¯å‡º
        function exportData() {
            if (records.length === 0) return alert('æ²’æœ‰è¨˜éŒ„å¯åŒ¯å‡º');
            
            const headers = ['æ—¥æœŸ', 'é‡‘é¡', 'é¡åˆ¥', 'é¡å‹'];
            const csvContent = [
                headers.join(','),
                ...records.map(r => `${r.date},${r.amount},${r.category},${r.type}`)
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `è¨˜å¸³å‚™ä»½_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // CSVåŒ¯å…¥
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n').slice(1); // è·³éæ¨™é¡Œåˆ—
                const newRecords = lines.map(line => {
                    const [date, amount, category, type] = line.split(',');
                    return { date, amount, category, type };
                }).filter(r => r.date && r.amount);
                
                if (newRecords.length > 0) {
                    records = [...newRecords, ...records];
                    localStorage.setItem('records', JSON.stringify(records));
                    renderRecords();
                    updateStats();
                    alert(`æˆåŠŸåŒ¯å…¥ ${newRecords.length} ç­†è¨˜éŒ„ï¼`);
                }
            };
            reader.readAsText(file, 'Big5'); // æ”¯æ´ä¸­æ–‡CSV
        }
        
        // åˆå§‹åŒ–
        if (records.length > 0) {
            document.getElementById('date').valueAsDate = new Date();
        } else {
            document.getElementById('date').valueAsDate = new Date();
        }
        renderRecords();
        updateStats();
    </script>
</body>
</html>
